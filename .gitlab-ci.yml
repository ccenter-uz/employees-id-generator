stages:
  - build
  - deploy

variables:
  DOCKER_DRIVER: overlay2
  DOCKER_HOST: "unix:///var/run/docker.sock"  # Используем локальный сокет Docker

build-job:
  stage: build
  image: node:22.11.0
  before_script:
    - cd $CI_PROJECT_DIR
  script:
    - docker info  # Проверяем доступность Docker
    - docker build --build-arg VITE_APP_VERSION=$VITE_APP_VERSION --build-arg VITE_APP_GITHUB_LINK=$VITE_APP_GITHUB_LINK --build-arg VITE_APP_RELEASES_LINK=$VITE_APP_RELEASES_LINK -t employees .
  only:
    - main  # Замените на вашу основную ветку

deploy-job:
  stage: deploy
  script:
    - docker stop $(docker ps -q --filter ancestor=employees) || true
    - docker rm $(docker ps -q --filter ancestor=employees) || true
    - docker run -d -p 3007:80 employees
  only:
    - main  # Замените на вашу основную ветку
